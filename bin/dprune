#!/usr/bin/env bash
set -euo pipefail

count=0
while IFS= read -r dir; do
  git check-ignore "$dir" &>/dev/null && continue
  rmdir "$dir" 2>/dev/null || continue
  echo "Removed: $dir"
  ((count++))
done < <(find . -type d -empty -not -path '*/.git/*' -not -name '.git' 2>/dev/null | sort -r)

if [[ $count -eq 0 ]]; then
  echo "No empty directories found"
else
  echo "Removed $count empty director$([[ $count -eq 1 ]] && echo 'y' || echo 'ies')"
fi
