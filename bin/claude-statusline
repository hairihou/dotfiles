#!/usr/bin/env bash
set -euo pipefail

eval "$(jq -r '
  @sh "model=\(.model.display_name)",
  "pct=\(.context_window.used_percentage // 0 | floor)",
  "cost=\(.cost.total_cost_usd // 0)"
')"

green='\033[92m'; yellow='\033[93m'; red='\033[91m'; gray='\033[90m'; reset='\033[0m'

# Context bar
bars=('░░░░░░░░' '█░░░░░░░' '██░░░░░░' '███░░░░░' '████░░░░' '█████░░░' '██████░░' '███████░' '████████')
bar=${bars[pct * 8 / 100]}
if ((pct >= 90)); then bar_color=$red
elif ((pct >= 70)); then bar_color=$yellow
else bar_color=$green; fi

echo -e "[${model}] ${bar_color}${bar}${reset} ${pct}% ${gray}$(printf '$%.2f' "$cost")${reset}"
