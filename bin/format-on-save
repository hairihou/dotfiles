#!/usr/bin/env bash
set -euo pipefail

[[ -t 0 ]] && exit 0

file=$CLAUDE_TOOL_INPUT_FILE_PATH
[[ -z "$file" || ! -f "$file" ]] && exit 0

cd "$(dirname "$file")"
while [[ "$PWD" != "/" && ! -d ".git" ]]; do cd ..; done
root=$PWD

[[ -f "$root/.venv/bin/ruff" ]] && { "$root/.venv/bin/ruff" format "$file"; "$root/.venv/bin/ruff" check --fix "$file"; } 2>/dev/null || true
command -v goimports &>/dev/null && goimports -w "$file" 2>/dev/null || { command -v gofmt &>/dev/null && gofmt -w "$file" 2>/dev/null; } || true

while [[ "$PWD" != "/" && ! -f "package.json" ]]; do cd ..; done
run=$([[ -f 'pnpm-lock.yaml' ]] && echo 'pnpm' || echo 'npx')
[[ -f 'node_modules/.bin/biome' ]] && $run biome check --files-ignore-unknown=true --write "$file" 2>/dev/null || true
[[ -f 'node_modules/.bin/prettier' ]] && $run prettier --ignore-unknown --write "$file" 2>/dev/null || true
