#!/usr/bin/env bash
set -euo pipefail

[[ -t 0 ]] && exit 0

file=$CLAUDE_TOOL_INPUT_FILE_PATH
[[ -z "$file" || ! -f "$file" ]] && exit 0

cd "$(dirname "$file")"
while [[ "$PWD" != "/" && ! -f "package.json" ]]; do cd ..; done
run='npx'
[[ -f 'pnpm-lock.yaml' ]] && run='pnpm' || true
[[ -f 'node_modules/.bin/prettier' ]] && $run prettier --ignore-unknown --write "$file" 2>/dev/null || true

[[ -n "$(tail -c1 "$file")" ]] && echo >> "$file"
